/**
 *Submitted for verification at polygonscan.com on 2022-03-21
*/

// SPDX-License-Identifier: MIT

/*
                                                                        ...'...                                                                                                
                                                                  .`^""""^^^^^"""""^^^^``''..                                                                                  
                                                               '":,""",,,,,,,""^^^,::;:::,"""""`.                                                                              
                                                              "::::::::::,,,,,,,,:;l;"`'''`^:;"^^^'   .`^^"`                                                                   
                                                            .`::::::;;III;I;::,Iii:'         'I;"^^"",^`''',`                                                                  
                                                          .",^",,,,,,,,,,:;II;<i<,.           .;;,"`""``^`'^,                                                                  
                                                         ";"`^,,,,,:::,,,,,,;~iii`             `>","`^,^`''`,                                                                  
                                                '^^""""^,;::,:::I!!I,:;,,,,,;~ii>^             'i,,,^`^^`''^`                                                                  
                                 '``''.        ':`''''''''''''''``^";,l,,,,,:l<i~:.            `<",,^``"`''".                                                                  
                              .^,^^^^^",,^'    .;`'`^^^^^^^``'''''`^;"l,,,,,,;~ii<;`         .`;I,,,,""""```                                                                   
                             `,^^^^``'.''^":'   `:```````^""""^`''`";,I,,,,,,,;<<i>iI"`''''`"IiI,,,,,,,,,,"^^``'                                                               
                           .,^^^^`..'`",,,,,;    ',`'''''''`""""``^;";,,,,,,,,,:I><<>><~~<<>iI:::::::,,"""^^^":;"                                                              
                          `"^^^`'.`",:,,,,:,".    ."``'''''`""```,;,;:,,,,,,,,,,,:;:::III;II;;;;;;;;;;;;;;;;;;;;"                                                              
                         `^^^^`.`"::,,::^'          `"''''`"^``^:,,;,,,,,,,,,,::,":;II;;;;;:,""^^^^"`^lxl'~,;il^.                                                              
                        `^^^^''"::,,,`.             '!,`'`^``^::,:,,,,,,,,,,,,"";lI;;;;,,"^```'''`'"z+1&`^[`'```^"^.                                                           
                       `^^^^``::,,`.                .l;:""",,::;I:,,,,,,"""",:Il;;I:,^``'`^`''''''``^l~:;"`'''.....,,..                                                        
               .'     '"^^^^":,,'                   .!;:::;;II;;;;IIIIIIIIII;;;Il,|*1',W`'-^''''''......^,;I:^.. .`."^....                                                     
              >+~_,^""",,,"","'                      ;;,,;;;;;I;,,,",,:;IIII;,"``^`;<<,.^?,`''''.... `~(\///tvf`.`''',.                                                        
              ':_i^.^^^^^",,'                        ^II;;;l;"^^``''``'`````'''''``,:;li"`'``^`'. ..')\jB$ctM$vl"`''', ...                                                     
                `:^..`^,,:,,.                        `l;;;;"^^````'''''''..........'''```^^^``''``^"^"{t#Wutfx}`'''.."                                                         
                ^,,"",;;<i;:.                       .!;;;l^^^``'''''''''..................'''..'''``^^`,+{()|;'''`'..^                                                         
               `,::,,I,>-+~i`.                      .l;;;>,^^`'''''''''............. ...... .`'....'''''''''l"^"`'...`                                                         
             .^^^^^":I:,""l_+~,'                     ."I;Il,^`'''''''''.................''''`...''''`^""""::"^^`... '.                                                         
            '^^`'^^,,`     .:-_<>".                     .. ',`''`''''''' ...............'````^^^^"""`''''''''.......'                                                          
           `^^`.`",,'         ^<-_+l`.                      ^`''''''''''.....................''''''''''........... ..                                                          
          `^^`.',,,.            'I]__<:'                    .^''''''''''...................... ...... . ............                                                           
         `^^`.',,,'               ."_+<~<".                  "`''''''''''.........................................'''.'''````'.                                                
        ."^^.',::'                   `!-++_!`              .."''''''''''''....................................  .``""`''''''''`^^`'                                            
        "^^'.";,`                      .:?i,","'          .^`^'''''''''''''.. .................................'``"`''''''''''''''`"^.                                         
       .,^^.`;,,                         i`'''`"l^.       ```^`'''''''''''`'..................................```"`'''''`'''''''''''`"".                                       
       ^^^`.:::'                        .I'''''':<~;,`````"```^^`''''''''''................................'`^``""''''''''''''''''''''`:                                       
       :^^.`;,,                          !'''''',?_<~+l"^^,`````^^``''''..   ...  ......... ....  . .....`^````^^^`''''''''''''''''''`':.                                      
       ;^^.";:'                          ,^''''`^!_}-~~_<I,````````^^`.      ..     ....     ..     .'`^^``````"^``''''''''''''''''''``;                                       
       :^^',,;                           .;`''''`"^,i[?_~+_!,````````^^`'    ..      ..      ....'`^^^`````````"^`'''''''``'''''''''''"`                                       
       ""^':,,                            .,`''''``^^^;?[+~+_+;^`````````^^^```      .'''``^^""^```````````````^^``''''`'``'`'''''''`,,                                        
       .,^`:,"                              ^`'''''``^^^,-}-?++_i,```````````^"       `,````````````````````````"^``'''`````'''''''`^"",,`                                     
        ,^`,,"                               .``''`''```^:"l][-~~++I^````````^^   .   .:^```````````````````````^"^```''``"""````'``'''`""     .''                             
        .:^":,                                  '``''''`,"```,_}?_+<+<:^`````^^   ...  ,"`````````````````````````^^^""""^```^"^``````^:l.   .,^``,`                           
         ^,^:I                                    .''`^":^`````"l]]?+~+_l,```^^   ..   `,``````````````````````````````````````^"""",,"^"   ',`''''^:                          
          "",;'                                       .,^`````````,+[?_~<__:`^^   ..   .:`````````````````````````````````````````````^^   ','''''''^:                         
           ^,,;                                       ""````````````"i[?[]]_`^"   ..    ,^```````````````````````````````````````````^'   .,'''''''``:^                        
            `::^                                     `,````````````````:<i;^`^,  ...    `"```````````````````````````````````````````     "''''''''''`<.                       
             ';I.                                   ':````````````````````````,  ...    ',`````````````````````````````````````````'     ."''''''''''`!'                       
               ^!.                                  ""````````````````````````,   ..    .;``````````````````````````````````````^``'`'   .^'''`''''`^,l:,,",,"""^`'.           
                ."'                                 ^,````````````````````````,.  ..     :^``````````````````````````````````^^``'''''`..'"''''''''`'''''''''''''`^,;,'        
                  .                                 .""```````````````````````^`  ..     ,^````````````````````````````````^^``''''''''^```''''''''`'''''''''''''''''`,I'      
                                                      .^,^`````````````````````"  .      ""````````````````````````````^"^^`'''''''''''`^'''''''''''''''''''''`''''''''`+.     
                                                         '`^"^`````````````````"'   .    ""````````````````````````^""^``''''''''''''''```''''''''''''''''''''''''''''`:;.     
                                                             .``^^``````````````,' ..    ,^```````````````````^"""^``'''''''''''''''''''''''''`^`''''''''''''''''''`,;".       
                                                                  .''``^`````````"' ..  .;^^`````````^^""""^^^^``'''''''''''''''''''''''''`'`"!:l"`'''''''''''``":;"'          
                                                                        ...''''''.   ..  .''```````''''..... .''''''''''''''''''''''''`'''^:;`  .`",:::,,,:::,,^'.             
                                                                           ..  .       .      ..           ....''''''''''''''''''''''''`,I".           ...                     
                                                                            ....        .       .           .  .'''''''''''''''''''``,;"'                                      
                                                                               ''.                ..          ....'''''''''''''''`,;"'                                         
                                                                                 .''                 .             ..'''''''``":,`.                                            
                                                                                    '''.      .         ..             ..`,:,^.                                                
                                                                                       .'''..   .                  .'`"""`.                                                    
                                                                                           ..''``````'''''''```^^^^`'.                                                         
                                                                                                     ......                                                                    


                                                                        DOGEWHALE MINING OPERATIONS v1.0          
                                                                    grab that pick and get to work woobly boi
                                                                                    PUMP ET!

by DeFi LABS
*/

pragma solidity ^0.8.7;

abstract contract Initializable {
    bool private _initialized;
    bool private _initializing;
    modifier initializer() {
        require(_initializing || !_initialized, "Initializable: contract is already initialized");

        bool isTopLevelCall = !_initializing;
        if (isTopLevelCall) {
            _initializing = true;
            _initialized = true;
        }

        _;

        if (isTopLevelCall) {
            _initializing = false;
        }
    }
}

abstract contract Context {
    function _msgSender() internal view virtual returns (address) {
        return msg.sender;
    }

    function _msgData() internal view virtual returns (bytes calldata) {
        return msg.data;
    }
}

interface IERC20 {
    function totalSupply() external view returns (uint256);
    function balanceOf(address account) external view returns (uint256);
    function transfer(address recipient, uint256 amount) external returns (bool);
    function allowance(address owner, address spender) external view returns (uint256);
    function approve(address spender, uint256 amount) external returns (bool);
    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);
    function decimals() external view returns (uint256);
}

contract DogewhaleMining is Initializable, Context {

    mapping(address => bool) public abuser;             //blacklist control for possible abusers
    mapping(address => uint256) public wenLastMined;    //timestamp of the last mined dogewhale
    uint256 public cooldown;                            //cooldown period before mining again to prevent attacks

    address public dogewhale_contract;                  //dogewhale token contract address
    uint256 public reward_upper_limit;                  //reward can't exceed the amount in the upper limit
    uint256 public reward_standard;                     //a standard predictable mining reward
    uint256 public reward_extra;                        //a more generous reward

    //permissions
    address public deployer;
    address public ge_contract;

    //mining records
    mapping(address => uint256) public howMuchMined;    //shows how much an address has mined

    //state of mining
    bool public isMiningActive;                         //toggles mining on/off
    string public version;                              //miner version control for updates
    string public downloadLink;                         //ipfs download link for decentralized desktop mining

    function init() external initializer {
        cooldown = 5;
        reward_standard = 5;
        reward_extra = 15;
        dogewhale_contract = 0xf07F6AFbeeb5e0378cE29D7dFa5E252FBd1D7B6b;    //wrapped dogewhale on Polygon Chain
        deployer = 0x16f7c37FF84a71a8be7EB24228Cdc8E438D12060;
    }

    /////////////////////////////////////////////////////////////////////////////////////////////////
    // ADMIN FUNCTIONS =============================================================================>
    /////////////////////////////////////////////////////////////////////////////////////////////////

    function setGEContract(address _ge_contract) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        ge_contract = _ge_contract;
        return true;
    }

    function setRewardUpperLimit(uint256 _upperLim) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        reward_upper_limit = _upperLim;
        return true;
    }

    function setRewards(uint256 _standardReward, uint256 _extraReward) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        reward_standard = _standardReward;
        reward_extra = _extraReward;
        return true;
    }

    function setCooldown(uint256 _seconds) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        cooldown = _seconds;
        return true;
    }

    function toggleAbuser(address _abuser) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        if (abuser[_abuser] == false) {
            abuser[_abuser] = true;
        } else {
            abuser[_abuser] = false;
        }
        return true;
    }

    function toggleMiningActive() public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        if (isMiningActive == false) {
            isMiningActive = true;
        } else {
            isMiningActive = false;
        }
        return true;
    }

    function setVersion(string memory _version) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        version = _version;
        return true;
    }

    function setDownloadLink(string memory _dLink) public virtual returns (bool) {
        require(_msgSender() == deployer, "Unauthorized");
        downloadLink = _dLink;
        return true;
    }

    /////////////////////////////////////////////////////////////////////////////////////////////////
    // MINING REWARD FUNCTIONS =====================================================================>
    /////////////////////////////////////////////////////////////////////////////////////////////////

    function rewardMinerStandard(address _minerAddy) public virtual returns (bool) {
        require(_msgSender() == ge_contract, "Unauthorized");
        require(abuser[_minerAddy] == false);
        require(block.timestamp > wenLastMined[_minerAddy]+cooldown, "Easy fella");
        require(isMiningActive == true, "Mining is off");

        IERC20(dogewhale_contract).transfer(_minerAddy, reward_standard);
        wenLastMined[_minerAddy] = block.timestamp;
        howMuchMined[_minerAddy] += reward_standard;
        return true;
    }

    function rewardMinerExtra(address _minerAddy) public virtual returns (bool) {
        require(_msgSender() == ge_contract, "Unauthorized");
        require(abuser[_minerAddy] == false);
        require(block.timestamp > wenLastMined[_minerAddy]+cooldown, "Easy fella");
        require(isMiningActive == true, "Mining is off");

        IERC20(dogewhale_contract).transfer(_minerAddy, reward_extra);
        wenLastMined[_minerAddy] = block.timestamp;
        howMuchMined[_minerAddy] += reward_extra;
        return true;
    }

    function rewardMinerDynamic(address _minerAddy, uint256 _reward) public virtual returns (bool) {
        require(_msgSender() == ge_contract, "Unauthorized");
        require(_reward > 0 , "No zero reward");
        require(_reward <= reward_upper_limit, "Out of bounds");
        require(abuser[_minerAddy] == false);
        require(block.timestamp > wenLastMined[_minerAddy]+cooldown, "Easy fella");
        require(isMiningActive == true, "Mining is off");

        IERC20(dogewhale_contract).transfer(_minerAddy, _reward);
        wenLastMined[_minerAddy] = block.timestamp;
        howMuchMined[_minerAddy] += _reward;
        return true;
    }
}